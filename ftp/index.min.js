(function(e){"function"===typeof define&&define.amd?define(["exports"],function(t){window.Orienter=e(t)}):"undefined"!==typeof exports?e(exports):window.Orienter=e({})})(function(e){e=function(){this.initialize.apply(this,arguments)};e.prototype={lon:0,lat:0,direction:0,fix:0,os:"",initialize:function(e){e=e||{};this.onOrient=e.onOrient||function(){};this.onChange=e.onChange||function(){};this._orient=this._orient.bind(this);this._change=this._change.bind(this);this.lat=this.lon=0;this.direction=window.orientation||0;switch(this.direction){case 0:this.fix=0;break;case 90:this.fix=-270;break;case-90:this.fix=-90}navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/)?this.os="ios":this.os=-1<navigator.userAgent.indexOf("Android")||navigator.userAgent.indexOf("Linux")?"android":""},init:function(){window.addEventListener("deviceorientation",this._orient,!1);window.addEventListener("orientationchange",this._change,!1)},destroy:function(){window.removeEventListener("deviceorientation",this._orient,!1);window.removeEventListener("orientationchange",this._change,!1)},_change:function(e){this.direction=window.orientation;this.onChange(this.direction)},changeDirectionTo:function(e){this.direction=e},_orient:function(e){switch(this.os){case"ios":switch(this.direction){case 0:this.lon=e.alpha+e.gamma;0<e.beta&&(this.lat=e.beta-90);break;case 90:this.lon=0>e.gamma?e.alpha-90:e.alpha-270;this.lat=0<e.gamma?90-e.gamma:-90-e.gamma;break;case-90:this.lon=0>e.gamma?e.alpha-90:e.alpha-270,this.lat=0>e.gamma?90+e.gamma:-90+e.gamma}break;case"android":switch(this.direction){case 0:this.lon=e.alpha+e.gamma+30;this.lat=90<e.gamma?90-e.beta:e.beta-90;break;case 90:this.lon=e.alpha-230;this.lat=0<e.gamma?270-e.gamma:-90-e.gamma;break;case-90:this.lon=e.alpha-180,this.lat=-90+e.gamma}}this.lon+=this.fix;this.lon%=360;0>this.lon&&(this.lon+=360);this.lon=Math.round(this.lon);this.lat=Math.round(this.lat);this.onOrient({a:Math.round(e.alpha),b:Math.round(e.beta),g:Math.round(e.gamma),lon:this.lon,lat:this.lat,dir:this.direction})}};return e});$.fn.extend({fiHandler:function(e){e.stopPropagation();this.removeClass("opacity "+this.tp.cls);if(this.tp.cb){this.tp.cb()}this.off("webkitAnimationEnd");this.tp.cb=undefined;this.tp.duration=this.tp.cls=""},foHandler:function(e){e.stopPropagation();this.hide().removeClass(this.tp.cls);if(this.tp.cb){this.tp.cb()}this.off("webkitAnimationEnd");this.tp.cb=undefined;this.tp.duration=this.tp.cls=""},fi:function(e){this.tp={cb:undefined,duration:"",cls:""};this.tp.cls="ani-fadeIn";if(arguments){for(var t in arguments){switch(typeof arguments[t]){case"function":this.tp.cb=arguments[t];break;case"number":this.tp.duration=arguments[t];this.tp.cls+=this.tp.duration;break}}}this.on("webkitAnimationEnd",this.fiHandler.bind(this)).addClass("opacity "+this.tp.cls).show();return this},fo:function(e){this.tp={cb:undefined,duration:"",cls:""};this.tp.cls="ani-fadeOut";if(arguments){for(var t in arguments){switch(typeof arguments[t]){case"function":this.tp.cb=arguments[t];break;case"number":this.tp.duration=arguments[t];this.tp.cls+=this.tp.duration}}}this.on("webkitAnimationEnd",this.foHandler.bind(this)).addClass(this.tp.cls);return this}});function Scroll(e){this.$container=$(e.container);this.$scrollObj=$(e.scrollObj);this.visibleWidth=parseFloat(this.$container.css("width"));this.visibleHeight=parseFloat(this.$container.css("height"));this.scrollWidth=parseFloat(this.$scrollObj.css("width"));this.scrollHeight=parseFloat(this.$scrollObj.css("height"));this.newY=0;this.lastY=0;this.deltaY=0;this.scrollY=0;this.limitY=0;this.overlimitY=0;this.slideK=1;this.startTime=0;this.offsetTime=0;this.isBottom=false;this.refresh=e.refresh?e.refresh:undefined;this.isRefreshing=false;this.preloader;if(this.refresh){this.preloader=this.$container.find(".scroll-preloader");this.preloader.remove();this.refresh()}this.init()}$.extend(Scroll.prototype,{init:function(){this.newY=0;this.lastY=0;this.deltaY=0;this.scrollY=0;this.update();if(this.scrollY==this.limitY){this.isBottom=true}this.bindEvent()},update:function(){this.visibleWidth=parseFloat(this.$container.css("width"));this.visibleHeight=parseFloat(this.$container.css("height"));this.scrollWidth=parseFloat(this.$scrollObj.css("width"));this.scrollHeight=parseFloat(this.$scrollObj.css("height"));this.limitY=this.scrollHeight>this.visibleHeight?-(this.scrollHeight-this.visibleHeight):0;var e=parseFloat(this.$container.css("paddingTop"));var t=parseFloat(this.$container.css("paddingBottom"));this.limitY-=e+t},set:function(e){this.scrollY=e;this.$scrollObj[0].style.webkitTransform="translate3d(0,"+this.scrollY+"px,0)"},bindEvent:function(){this.$container.on({touchstart:this.onTouchstart.bind(this),touchmove:this.onTouchmove.bind(this),touchend:this.onTouchend.bind(this)})},onTouchstart:function(e){e.stopPropagation();this.newY=e.originalEvent.changedTouches[0].pageY;this.lastY=this.newY;this.startTime=(new Date).getTime()},onTouchmove:function(e){e.stopPropagation();e.preventDefault();this.offsetTime=(new Date).getTime()-this.startTime;this.newY=e.originalEvent.changedTouches[0].pageY;this.deltaY=this.newY-this.lastY;if(this.scrollY+this.deltaY<0){if(this.scrollY+this.deltaY>this.limitY){this.scrollY+=this.deltaY*this.slideK}else{this.scrollY=this.limitY;if(this.refresh&&!this.isRefreshing){this.processRefresh()}}}else{this.scrollY=0}this.$scrollObj[0].style.webkitTransform="translate3d(0,"+this.scrollY+"px,0)";this.lastY=this.newY},onTouchend:function(e){e.stopPropagation();this.offsetTime=(new Date).getTime()-this.startTime},processRefresh:function(){this.isRefreshing=true;this.refresh()},onTransitionEndToBottom:function(){console.log("1");this.isBottom=false;this.scrollY=this.limitY;this.slideK=2;this.$scrollObj.off("webkitTransitionEnd")}});function ImageLoader(){this.total=0;this.haveload=0;this.percent=0;this.complete=false;this.version=""}Object.assign(ImageLoader.prototype,{load:function(e,t,i){var a={0:[]};this.total=e.length;var n=this;s();function r(s){if(Object.prototype.hasOwnProperty.call(e[n.haveload],"group")){var o=e[n.haveload].group;if(a[o]instanceof Array==false){a[o]=[]}a[o].push(this)}else{a[0].push(this)}n.haveload++;n.percent=Math.floor(n.haveload/n.total*100);t(n.percent);this.onload=null;if(n.percent==100){n.complete=true;i(a);return}var l=new Image;l.onload=r;l.src=e[n.haveload].url+n.version}function s(){var t=new Image;t.onload=r;t.src=e[n.haveload].url+n.version}}});var Utils=new function(){this.preloadImage=function(e,t,i){var a=i||false;var n,r,s=0;var o=$(".num");for(n=0,r=e.length;n<r;n++){(function(e,i){e.onload=function(){main.loader.haveLoad+=1;var e=Math.ceil(main.loader.haveLoad/main.loader.total*100);e=100-e;if(a){o.html(e)}if(main.loader.haveLoad==main.loader.total){t&&t()}};e.onerror=function(){};e.onabort=function(){};e.src=i})(new Image,e[n])}},this.preloadImage2=function(e,t){var i,a,n=0;for(i=0,a=e.length;i<a;i++){(function(i,a){i.onload=function(){n+=1;if(n==e.length&&t){t()}};i.src=a})(new Image,e[i])}},this.lazyLoad=function(){var e=$(".lazy");var t=e.length;var i;var a=function(){for(var a=0;a<t;a++){i=e.eq(a);i.attr("src",i.attr("data-src"))}};a()};this.browser=function(e){var t=navigator.userAgent;var i=navigator.userAgent.toLowerCase();var a=navigator.platform;var n={trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&t.indexOf("KHTML")==-1,mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1,iPad:t.indexOf("iPad")>-1,webApp:t.indexOf("Safari")==-1,iosv:t.substr(t.indexOf("iPhone OS")+9,3),weixin:i.match(/MicroMessenger/i)=="micromessenger",taobao:t.indexOf("AliApp(TB")>-1,win:a.indexOf("Win")==0,mac:a.indexOf("Mac")==0,xll:a=="X11"||a.indexOf("Linux")==0,ipad:navigator.userAgent.match(/iPad/i)!=null?true:false};return n[e]};this.g=function(e){return document.getElementById(e)};this.limitNum=function(e){var t=$(e).val();var i=t.length;if(i>11){t=t.substring(0,11);$(e).val(t)}}};if(Utils.browser("ios")){var dom="<video src='video/hlbe.mp4' id='video1' width='100%' x-webkit-airplay='true' webkit-playsinline playsinline airplay='allow' x5-video-player-type='h5' data-type='hlbe' class='iosPreload video' v-if='ios' style='display:none;' loop='true'></video>"+"<video src='video/spanish.mp4' id='video2' width='100%' x-webkit-airplay='true' webkit-playsinline playsinline airplay='allow' x5-video-player-type='h5' data-type='spanish' class='iosPreload video' v-if='ios' style='display:none;' loop='true'></video>"+"<video src='video/wz.mp4' id='video3' width='100%' x-webkit-airplay='true' webkit-playsinline playsinline airplay='allow' x5-video-player-type='h5' data-type='wz' class='iosPreload video' v-if='ios' style='display:none;' loop='true'></video>";$(".player-container").append(dom)}var Media=new function(){this.mutedEnd=false;this.WxMediaInit=function(){var e=this;if(!Utils.browser("weixin")){this.mutedEnd=true;return}if(!Utils.browser("iPhone")){e.mutedEnd=true;return}document.addEventListener("WeixinJSBridgeReady",function(){var t=$(".iosPreload");$.each(t,function(i,a){e.MutedPlay(a["id"]);if(i+1==t.length){e.mutedEnd=true}})},false)},this.MutedPlay=function(e){var t=e.split(",");var i=function(e){var t=Utils.g(e);t.volume=0;t.play();t.pause();t.volume=1;t.currentTime=0};if(!(t.length-1)){i(t[0]);return 0}t.forEach(function(e,t){i(e)})},this.playMedia=function(e){var t=this;var i=setInterval(function(){if(t.mutedEnd){Utils.g(e).play();clearInterval(i)}},20)}};Media.WxMediaInit();var options={el:"#iCreative",data:{server_data:{is_end:!!parseInt($("#is_end").val()),have_guanzhu:!!parseInt($("#have_guanzhu").val()),isVip:!!parseInt($("#is_vip").val()),goRegist:!!parseInt($("#goRegist").val()),haveFill:!!parseInt($("#haveFill").val()),prizeType:parseInt($("#prizeType").val()),game:$("#gameData").val(),province:[],city:[],address:[],name:"",tel:"",select_province:"",select_city:"",select_address:"",shop_id:0,myInfo:{province:"",city:"",shop:""},gameData:{hlbe:{get:false,needAnimation:false},spanish:{get:false,needAnimation:false},wz:{get:false,needAnimation:false},currentPoint:""}},ios:Utils.browser("ios"),ploading:{visible:false},pwebgl:{visible:false},p1:{visible:false},p2:{visible:false},pprize:{visible:false},pfill:{visible:false},paddress:{visible:false},pvideo:{visible:false},pend:{visible:false},pshare:{visible:false},pquery:{visible:false},pguanzhu:{visible:false},prule:{visible:false},palert:{visible:false,type:"",choice:{fill:"fill",normal:"normal",reg:"reg"},fontSize:"",content:"",title:"",txt:{fill:"你还未填写领奖信息，<br>赶快去填写吧",reg:"为了确保星球领奖者的真实性,<br>系统需要进行实名认证,<br>请填写个人真实信息领取奖品!"}},hpwarn:{visible:false},pwait:{visible:false}},methods:{top_btn_rule:function(){this.prule.visible=true;if(!main.scroll){main.scroll=new Scroll({container:".scroll-area",scrollObj:".scroller"})}},prule_btn_xx:function(){this.prule.visible=false},after_leave_rule:function(){main.scroll.set(0)},after_enter_rule:function(){main.scroll.update()},onPwebglEnter:function(){main.initLX({container:$(".P_webgl"),delay:3e3});main.initLX({container:$("#bg .bg2"),delay:1500});if(vm.key_index==3&&vm.server_data.prizeType==0){$(".tip-all").show();$(".big-icon").show();$(".number").hide();$(".animation-box").fi()}},pwegbl_btn_chaxun:function(){this.pquery.visible=true},pwebgl_btn_getPrize:function(){if(!this.server_data.have_guanzhu){this.pguanzhu.visible=true;this.pwebgl.visible=false;main.stopRender();return}if(!this.server_data.isVip){var e=vm.palert.choice.reg;var t=vm.palert.txt[e];vm.openAlert(e,t);return}if(this.server_data.is_end){this.palert.type=this.palert.choice.normal;this.palert.content="本次活动已结束<br>期待EP雅莹更多活动<br>记得关注“EP雅莹官方微信”<br>敬请期待我们的下次活动";this.palert.visible=true;$(".animation-box").fo();return}var i=this;var a=function(e){if(e.status){i.server_data.prizeType=e.lottery_result;i.pprize.visible=true;i.pwebgl.visible=false;setTimeout(function(){$(".animation-box").hide()},1e3);main.stopRender()}else{console.log("抽奖后台出问题了"+e)}};_getData.getPrize(a)},pprize_btn_paddress:function(){this.paddress.visible=true},pprize_btn_share:function(){this.pshare.visible=true},pprize_btn_pfill:function(){this.pfill.visible=true;this.pprize.visible=false},pprize_btn_close:function(){main.startRender();this.pprize.visible=false;this.pwebgl.visible=true},pquery_btn_paddress:function(){this.paddress.visible=true},pquery_btn_share:function(){this.pshare.visible=true},pquery_btn_xx:function(){this.pquery.visible=false},pfill_btn_submit:function(){var e=this.server_data.tel;var t=this.server_data.name;var i=/^1(3|4|5|7|8)\d{9}$/;if(t==""){this.palert.type=this.palert.choice.normal;this.palert.content="请输入姓名";this.palert.visible=true;return}if(!i.test(e)){this.palert.type=this.palert.choice.normal;this.palert.content="请输入正确的手机号";this.palert.visible=true;return}if(this.server_data.select_province==""){this.palert.type=this.palert.choice.normal;this.palert.content="请选择省份";this.palert.visible=true;return}if(this.server_data.select_city==""){this.palert.type=this.palert.choice.normal;this.palert.content="请选择城市";this.palert.visible=true;return}if(this.server_data.select_address==""){this.palert.type=this.palert.choice.normal;this.palert.content="请选择门店";this.palert.visible=true;return}var a=function(e){if(e.status){location.href="index.php"}else{console.log(e)}};_uploadData.addInfo(a)},onPfillProvinceChangeHandle:function(e){var t=this;_getData.getCity(function(e){t.server_data.city=e.data})},onPfillCityChangeHandle:function(e){var t=this;_getData.getShop(function(e){t.server_data.address=e.data})},onPfillAddressChangeHandle:function(e){this.server_data.shop_id=e.target.selectedOptions[0].getAttribute("shopid")},onPaddress_btn_xx:function(){this.paddress.visible=false},onPaddressProvinceChangeHandle:function(e){var t=this;_getData.getCity(function(e){t.server_data.city=e.data})},onPaddressCityChangeHandle:function(e){var t=this;_getData.getShop(function(e){t.server_data.address=e.data})},onPaddressAddressChangeHandle:function(e){},back:function(){var e=this.router.length;if(e>0){var t=this.router[e-1];this[t].visible=true;this.router.splice(e-1,1)}},palert_btn_gofill:function(){this.pfill.visible=true;this.closeAlert()},palert_btn_goregist:function(){var e="http://epshow.i-creative.cn/summer/index.php?is_reg=1";location.href="http://o2o.elegant-prosper.com/EPWXSiteNew/VIP/CreateVIP?sid=cfe404ea-fe5b-4a85-87f0-b2701929462c&redirect_uri="+encodeURIComponent(e)},onPshareEnter:function(){},openAlert:function(e,t,i){var i=i?i:"";this.palert.type=e;this.palert.content=t;this.palert.visible=true;this.palert.fontSize=i},closeAlert:function(){this.palert.visible=false;this.palert.type="";this.palert.content="";this.palert.fontSize=""}},computed:{key_index:function(){var e=0;var t=this.server_data.gameData;for(var i in t){if(t[i].get){e++}}return e},key_last:function(){return 3-this.key_index}},delimiters:["$[","]"]};var vm=new Vue(options);vm.ploading.visible=true;var three=new function(){this.container;this.scene;this.camera;this.renderer;this.width;this.height;this.raycaster};three.init=function(){this.container=$("#WebGL");this.width=window.innerWidth;this.height=window.innerHeight;this.scene=new THREE.Scene;this.camera=new THREE.PerspectiveCamera(45,this.width/this.height,.1,1e4);this.camera.position.y=50;this.camera.position.z=1600;this.ocamera=new THREE.OrthographicCamera(-this.width/2,this.width/2,this.height/2,-this.height/2,1,1e3);this.ocamera.position.y=50;this.ocamera.position.z=15;this.scene2=new THREE.Scene;this.renderer=new THREE.WebGLRenderer({antialias:true,alpha:true,precision:"highp"});this.renderer.setPixelRatio(window.devicePixelRatio);this.renderer.setSize(this.width,this.height);this.renderer.autoClear=false;this.container.append(this.renderer.domElement);this.raycaster=new THREE.Raycaster;this.ddsloader=new THREE.DDSLoader;THREE.Loader.Handlers.add(/\.dds$/i,this.ddsloader)};three.loadOBJ=function(e){e=e?e:{};e.modelName=e.modelName?e.modelName:function(){console.error("加载obj文件，modelName不能为空");return}();e.objFile=e.objFile?e.objFile:function(){console.error("加载obj文件，fileName不能为空");return}();e.material=e.material?e.material:undefined;e.needTouch=typeof e.needTouch=="boolean"?e.needTouch:true;e.callback=e.callback?e.callback:undefined;var t=new THREE.OBJLoader;if(e.material){t.setMaterials(e.material);console.log(e.material)}t.load(e.objFile,function(t){e.callback&&e.callback(t);t.name=e.modelName;t.position.x=webgl.OBJData[e.modelName].position.x;t.position.y=webgl.OBJData[e.modelName].position.y;t.position.z=webgl.OBJData[e.modelName].position.z;t.rotation.x=webgl.OBJData[e.modelName].rotation.x;t.rotation.y=webgl.OBJData[e.modelName].rotation.y;t.rotation.z=webgl.OBJData[e.modelName].rotation.z;t.scale.x=webgl.OBJData[e.modelName].scale.x;t.scale.y=webgl.OBJData[e.modelName].scale.y;t.scale.z=webgl.OBJData[e.modelName].scale.z;webgl.OBJData[e.modelName].obj=t;if(webgl.OBJData[e.modelName].needTouch){webgl.touchObjects.push(object)}main.loader.haveLoad++;var i=Math.round(main.loader.haveLoad/main.loader.total*100);$(".num").html(100-i);if(main.loader.haveLoad==main.loader.total){main.loadCallBack()}},function(e){},function(e){console.log("加载obj出错")})};three.loadMTL=function(e){e=e?e:{};e.modelName=e.modelName?e.modelName:function(){console.error("加载mtl文件，modelName不能为空");return}();e.mtlFile=e.mtlFile?e.mtlFile:function(){console.error("加载mtl文件，文件名不能为空");return}();var t=new THREE.MTLLoader;if(e.baseUrl){t.setPath(e.baseUrl)}t.load(e.mtlFile,function(t){t.preload();if(e.objFile){three.loadOBJ({modelName:e.modelName,objFile:e.objFile,material:t})}},function(e){},function(e){console.log("加载mtl出错")})};three.loadCollada=function(e){e=e?e:{};e.url=e.url;e.successCallback=typeof e.successCallback=="function"?e.successCallback:function(e){console.log(e)};e.progressCallback=e.progressCallback?e.progressCallback:function(e){console.log(e)};e.failCallback=e.failCallback?e.failCallback:function(e){console.log(e)};var t=new THREE.ColladaLoader;t.load(e.url,e.successCallback,e.progressCallback,e.failCallback)};three.loadTexture=function(e){e=e?e:{};e.url=e.url?e.url:"";e.name=e.name?e.name:"";e.wrapS=typeof e.wrapS=="boolean"?e.wrapS:false;e.wrapT=typeof e.wrapT=="boolean"?e.wrapT:false;e.SuccessCallback=typeof e.SuccessCallback=="function"?e.SuccessCallback:function(){};var t=new THREE.TextureLoader;t.setCrossOrigin("");var i=t.load(e.url,function(t){e.SuccessCallback(t)},undefined,function(){});if(e.wrapS){i.wrapS=THREE.RepeatWrapping}if(e.wrapT){i.wrapT=THREE.RepeatWrapping}i.name=e.name;return i};three.loadAudio=function(e){var t=new THREE.AudioLoader};three.getSpotLight=function(e){e=e?e:{};e.color=e.color?e.color:16777215;e.intensity=e.intensity?e.intensity:1;e.distance=e.distance?e.distance:100;e.angle=e.angle?e.angle:Math.PI/3;e.exponent=e.exponent?e.exponent:10;var t=new THREE.SpotLight(e.color,e.intensity,e.distance,e.angle,e.exponent);t.position.x=100;t.position.y=100;t.position.z=0;return t};three.getPointLightHelper=function(e){if(e instanceof THREE.Light){return new THREE.SpotLightHelper(e)}};three.getDirectionalLight=function(e){e=e?e:{};e.color=e.color?e.color:16777215;e.intensity=e.intensity?e.intensity:1;var t=new THREE.DirectionalLight(e.color,e.intensity);if(e.position){t.position.set(e.position.x,e.position.y,e.position.z)}return t};three.getAmbientLight=function(e){e=e?e:{};e.color=e.color?e.color:16777215;e.intensity=e.intensity?e.intensity:1;var t=new THREE.AmbientLight(e.color,e.intensity);return t};three.getSkyByCubeGeo=function(e){var t="assets/texture/";e=e?e:{};e.size=e.size?e.size:1024;e.format=e.format?e.format:".jpg";e.urls=e.urls?e.urls:[t+"right"+e.format,t+"left"+e.format,t+"up"+e.format,t+"down"+e.format,t+"front"+e.format,t+"back"+e.format];var i=[];for(var a=0;a<e.urls.length;a++){i.push(new THREE.MeshLambertMaterial({map:this.loadTexture({url:e.urls[a]}),side:THREE.BackSide}))}var n=new THREE.Mesh(new THREE.CubeGeometry(e.size,e.size,e.size),new THREE.MeshFaceMaterial(i));return n};three.getSkyBySphere=function(e){e=e?e:{};e.R=e.R?e.R:50;e.Ws=e.Ws?e.Ws:8;e.Hs=e.Hs?e.Hs:6;e.phiStart=e.phiStart?e.phiStart:0;e.phiLength=e.phiLength?e.phiLength:2*Math.PI;e.thetaStart=e.thetaStart?e.thetaStart:0;e.thetaLength=e.thetaLength?e.thetaLength:Math.PI;e.texture=e.texture?e.texture:new THREE.Texture;var t=new THREE.SphereGeometry(e.R,e.Ws,e.Hs,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength);var i=new THREE.MeshBasicMaterial({map:e.texture,side:THREE.DoubleSide});var a=new THREE.Mesh(t,i);return a};three.getCubeGeometry=function(e){e=e?e:{};e.sizeX=e.sizeX?e.sizeX:100;e.sizeY=e.sizeY?e.sizeY:100;e.sizeZ=e.sizeZ?e.sizeZ:100;e.Xs=e.Xs?e.Xs:1;e.Ys=e.Ys?e.Ys:1;e.Zs=e.Zs?e.Zs:1;var t=new THREE.CubeGeometry(e.sizeX,e.sizeY,e.sizeZ,e.Xs,e.Ys,e.Zs);return t};three.getPlaneGeo=function(e){e=e?e:{};e.width=e.width?e.width:50;e.height=e.height?e.height:50;e.Ws=e.Ws?e.Ws:1;e.Hs=e.Hs?e.Hs:1;var t=new THREE.PlaneGeometry(e.width,e.height,e.Ws,e.Hs);return t};three.getSphereGeometry=function(e){e=e?e:{};e.R=e.R?e.R:50;e.Ws=e.Ws?e.Ws:8;e.Hs=e.Hs?e.Hs:6;e.phiStart=e.phiStart?e.phiStart:0;e.phiLength=e.phiLength?e.phiLength:2*Math.PI;e.thetaStart=e.thetaStart?e.thetaStart:0;e.thetaLength=e.thetaLength?e.thetaLength:Math.PI;var t=new THREE.SphereGeometry(e.R,e.Ws,e.Hs,e.phiStart,e.phiLength,e.thetaStart,e.thetaLength);return t};three.getPointMaterial=function(e){e=e?e:{};e.size=e.size?e.size:4;e.map=e.map?e.map:undefined;e.blending=e.blending?e.blending:THREE.AdditiveBlending};three.getOrbitControls=function(e){e=e?e:{};return new THREE.OrbitControls(this.camera,this.renderer.domElement)};three.addPerspectiveCameraHelper=function(e){e=e?e:this.camera;var t=new THREE.CameraHelper(e);this.scene.add(t);return t};three.getFps=function(){var e=new Stats;return e};three.getObjectByName=function(e){e=e?e:{};e.name=e.name?e.name:function(){console.error("getObjectByName时缺少name")}();e.scene=e.scene?e.scene:this.scene;return e.scene.getObjectByName(e.name)};three.raycasterResult=function(e){e=e?e:{};e.coords=e.coords?e.coords:new THREE.Vector2;e.searchFrom=e.searchFrom?e.searchFrom:this.scene;e.recursive=e.recursive?e.recursive:false;e.needGroup=e.needGroup?e.needGroup:false;e.coords.x=e.coords.x/this.width*2-1;e.coords.y=2*-(e.coords.y/this.height)+1;this.raycaster.setFromCamera(e.coords,this.camera);var t;t=this.raycaster.intersectObjects(e.searchFrom,e.recursive);if(t.length>0){if(e.needGroup){if(t[0].object.parent&&t[0].object.parent instanceof THREE.Group){t=t[0].object.parent}}else{t=t[0]}}else{t=undefined}return t};three.getTime=function(){return(new Date).getTime()};three.getTouchCoords=function(e){return{x:e.offsetX,y:e.offsetY}};three.render=function(){this.renderer.clear();this.renderer.render(this.scene,this.camera);this.renderer.clearDepth();this.renderer.render(this.scene2,this.ocamera)};three.onresize=function(){this.width=this.container.width();this.height=this.container.height();this.camera.aspect=this.width/this.height;this.camera.updateProjectionMatrix();this.ocamera.left=-this.width/2;this.ocamera.right=this.width/2;this.ocamera.top=this.height/2;this.ocamera.bottom=-this.height/2;this.ocamera.updateProjectionMatrix();this.renderer.setSize(this.width,this.height)};var webgl=new function(){this.debug=true;this.fps=undefined;this.orbit=undefined;this.gravity=undefined;this.loader={haveLoad:0,total:0,complete:false};this.assetsUrl="http://epshow.img.i-creative.cn/planet/assets/";this.picUrl=this.assetsUrl+"images/";this.texturePath=this.assetsUrl+"images/";this.modelsUrl=this.assetsUrl+"models/";this.videoUrl="video/";this.touchObjects=[];this.OBJData={scene:{name:"scene",baseUrl:this.assetsUrl,mtlFile:this.assetsUrl+"models/scene/scene.mtl",objFile:this.assetsUrl+"models/scene/scene.obj",position:{x:0,y:0,z:0},rotation:{x:0,y:0,z:0},scale:{x:.07,y:.07,z:.07},needTouch:false,liusu_center:undefined,liusu_up:undefined}};this.TextureData={};const e=Math.sqrt(3);const t=Math.sqrt(2);this.PointData={hlbe:{name:"hlbe",texture:this.picUrl+"hl.png",position:new THREE.Vector3(340/e,340/e,-340/e),obj:undefined,frames:"hlbe",width:224,height:224,img:$(".player-container .img1"),music:$("#hl")[0],icon:$(".right-box .icon2").eq(0),icon_bg:$(".icon-box1 .icon-bg"),video:$("#video1"),video_haveload:false},spanish:{name:"spanish",texture:this.picUrl+"sp.png",position:new THREE.Vector3(340/e,340/e,340/e),obj:undefined,frames:"spanish",width:224,height:224,img:$(".player-container .img2"),music:$("#sp")[0],icon:$(".right-box .icon2").eq(1),icon_bg:$(".icon-box2 .icon-bg"),video:$("#video2"),video_haveload:false},wz:{name:"wz",texture:this.picUrl+"wz.png",position:new THREE.Vector3(-340/e,-340/e,-340/e),obj:undefined,frames:"wz",width:224,height:224,img:$(".player-container .img3"),music:$("#wz")[0],icon:$(".right-box .icon2").eq(2),icon_bg:$(".icon-box3 .icon-bg"),video:$("#video3"),video_haveload:false}};this.currentPointName="";this.sky=undefined;this.cloud=undefined;this.stone1=undefined;this.stone2=undefined;this.stars=undefined;this.earthGroup=undefined;this.earthChangeTexture=[];this.textureIndex=0;this.ogroup=new THREE.Group;this.clock=new THREE.Clock};webgl.init=function(){this.loader.total=Object.keys(this.OBJData).length};webgl.load=function(){for(var e in this.OBJData){var t=this.OBJData[e];three.loadOBJ({modelName:t.name,objFile:t.objFile,callback:function(e){webgl.stone1=e.children[0];webgl.stone2=e.children[1];webgl.liusu_up=e.children[2];webgl.liusu_center=e.children[3];webgl.planet=e.children[4]}})}};webgl.loadCallback=function(){for(var e=1;e<=38;e++){var t=three.loadTexture({url:main.modelsUrl+"scene/ls/"+e+".png"});this.earthChangeTexture.push(t)}this.addAmbientLight();this.addDirectionLight();this.addEarth();this.addCross();this.addOrbit();this.orbit.enabled=false;this.orbit.enableZoom=false;this.orbit.rotateSpeed=.5};webgl.addAmbientLight=function(){var e=three.getAmbientLight({color:0,intensity:1});three.scene.add(e)};webgl.addDirectionLight=function(){var e=three.getDirectionalLight({color:1118481,intensity:.1,position:{x:0,y:300,z:0}});three.scene.add(e);if(this.debug){var t=new THREE.DirectionalLightHelper(e)}};webgl.addOrbit=function(){this.orbit=new THREE.OrbitControls(three.camera,$("#gl-touch")[0]);this.orbit.enableZoom=true;this.orbit.target=webgl.earthGroup.position};webgl.addGravity=function(){this.gravity=new THREE.DeviceOrientationControls(this.sky)};webgl.addEarth=function(){var e=new THREE.Group;e.scale.set(0,0,0);e.position.set(0,50,-200);e.rotation.y=2*Math.PI;var t=new THREE.MeshPhongMaterial({map:three.loadTexture({url:this.assetsUrl+"models/scene/planet.png"}),normalMap:three.loadTexture({url:this.assetsUrl+"models/scene/normal_planet.png"}),shininess:20,emissive:1118481,emissiveIntensity:0});this.planet.material=t;e.add(this.planet);var i=new THREE.MeshLambertMaterial({color:"white",map:three.loadTexture({url:this.assetsUrl+"models/scene/ls/1.png"}),side:THREE.DoubleSide,depthWrite:false,transparent:true,opacity:.8});this.liusu_up.material=i;this.liusu_up.scale.set(1.01,1.01,1.01);this.liusu_up.rotation.set(2,2,2);e.add(this.liusu_up);var a=new THREE.MeshLambertMaterial({color:"white",map:three.loadTexture({url:this.assetsUrl+"models/scene/ls/1.png"}),side:THREE.DoubleSide,depthWrite:false,transparent:true,opacity:.8});this.liusu_center.material=a;this.liusu_center.scale.set(1.01,1.01,1.01);this.liusu_center.rotation.set(1.01,1.01,1.01);e.add(this.liusu_center);this.earthGroup=e;three.scene.add(e);for(r in this.PointData){var n=this.PointData;var r=n[r];r.texture=three.loadTexture({url:r.texture});var s=new THREE.Sprite(new THREE.SpriteMaterial({map:r.texture,depthWrite:false}));s.position.set(r.position.x,r.position.y,r.position.z);s.scale.set(r.width*1.3,r.width*1.3,1);e.add(s);s.name=r.name;r.obj=s}};webgl.addStars=function(){var e=three.loadTexture({url:this.picUrl+"star2.png"});var t=new THREE.SpriteMaterial({map:e,transparent:true,depthWrite:false});this.stars=new THREE.Group;for(var i=0;i<200;i++){var a=parseInt(Math.random()*3);switch(a){case 0:var n=THREE.Math.randFloat(800,1e3);var r=THREE.Math.randFloat(0,1e3);var s=THREE.Math.randFloat(0,1e3);break;case 1:var n=THREE.Math.randFloat(0,1e3);var r=THREE.Math.randFloat(800,1e3);var s=THREE.Math.randFloat(0,1e3);break;case 2:var n=THREE.Math.randFloat(0,1e3);var r=THREE.Math.randFloat(0,1e3);var s=THREE.Math.randFloat(800,1e3);break}var o=Math.random()-.5>0?1:-1;n*=o;o=Math.random()-.5>0?1:-1;r*=o;o=Math.random()-.5>0?1:-1;s*=o;var l=new THREE.Sprite(t);var h=THREE.Math.randFloat(30,50);l.scale.set(h,h,1);l.position.set(n,r,s);this.stars.add(l)}three.scene.add(this.stars)};webgl.addSky=function(){var e=three.getSkyByCubeGeo({size:2048});this.sky=e;three.scene.add(e)};webgl.addCross=function(){var e=three.loadTexture({url:main.picUrl+"p1-miaozhun.png"});var t=new THREE.SpriteMaterial({map:e});var i=new THREE.Sprite(t);i.position.set(0,50,0);i.scale.set(40,40,1);three.scene2.add(i)};webgl.updateStar=function(){var e=this.stars.children.length;for(var t=0;t<e;t++){var i=parseInt(10*Math.random());TweenMax.fromTo(this.stars.children[t].material,1,{opacity:1},{opacity:0,repeat:-1,yoyo:true})}};webgl.addFps=function(){this.fps=three.getFps();document.getElementById("FPS").appendChild(this.fps.domElement)};webgl.addAxisHelper=function(){var e=new THREE.AxisHelper(1e3);three.scene.add(e)};webgl.updateTexture=function(){this.liusu_center.material.map=this.earthChangeTexture[this.textureIndex];this.liusu_up.material.map=this.earthChangeTexture[this.textureIndex];this.liusu_center.material.needsUpdate=true;this.liusu_up.material.needsUpdate=true;this.liusu_center.rotation.x+=.001;this.liusu_center.rotation.y+=.001;this.liusu_center.rotation.z+=.001;this.liusu_up.rotation.x+=.001;this.liusu_up.rotation.y+=.001;this.liusu_up.rotation.z+=.001;if(this.textureIndex<this.earthChangeTexture.length-1){this.textureIndex++}else{this.textureIndex=0}};webgl.rotateToCenter=function(){var e=(new THREE.Vector3).copy(three.camera.position);var t=undefined;var i=undefined;var a=undefined;for(var n in this.PointData){var r=this.PointData[n].obj;var s=r.getWorldPosition().distanceTo(e);if(!t){t=s;i=r;this.currentPointName=this.PointData[n].name;vm.server_data.gameData.currentPoint=this.currentPointName}else{if(s<t){t=s;i=r;this.currentPointName=this.PointData[n].name;vm.server_data.gameData.currentPoint=this.currentPointName}}}var o=(new THREE.Vector3).copy(i.getWorldPosition());var l=(new THREE.Vector3).subVectors(o,this.earthGroup.position);var h=(new THREE.Vector3).subVectors(e,this.earthGroup.position);a=l.angleTo(h);var c=(new THREE.Vector3).copy(l);c.cross(h).normalize();var u=(new THREE.Quaternion).setFromAxisAngle(c,a);var d=new THREE.Quaternion;d.copy(this.earthGroup.quaternion);u.multiply(d);var p=new THREE.Quaternion;var r={t:0};TweenMax.to(r,1,{t:1,onUpdate:function(){THREE.Quaternion.slerp(d,u,p,r.t);webgl.earthGroup.quaternion.set(p.x,p.y,p.z,p.w)},onComplete:function(){if(main.touch.isTouch){main.stage=2;main.player1.direction=1;main.player1.repeat=0;var e=function(){main.stage=3;$("#player1").fo();webgl.PointData[webgl.currentPointName].img.fi();if(vm.server_data.gameData[webgl.currentPointName].get==false){_uploadData.uploadGameData(function(e){console.log(e)});webgl.PointData[webgl.currentPointName].icon.css({opacity:0});vm.server_data.gameData[webgl.currentPointName].get=true;vm.server_data.gameData[webgl.currentPointName].needAnimation=true}if(vm.ios){webgl.PointData[webgl.currentPointName].video.show();webgl.PointData[webgl.currentPointName].video[0].play()}else{$("#player2").show();main.player2.init(main.frames[webgl.currentPointName].urls);main.player2.repeat=0;main.player2.callback1=function(){main.player2.set(0);main.player2.play();webgl.PointData[webgl.currentPointName].music.currentTime=0;webgl.PointData[webgl.currentPointName].music.play()};main.player2.play();webgl.PointData[webgl.currentPointName].music.play()}};main.player1.callback1=e;$("#player1").show();$(".player-container").fi();main.player1.play();main.stopRender()}}})};webgl.rotateEarth=function(){this.earthGroup.rotation.y-=.001};webgl.render=function(){this.clock.startTime=Date.now();if(this.clock.startTime-this.clock.oldTime>50){this.updateTexture();this.clock.oldTime=this.clock.startTime}this.rotateEarth()};var main=new function(){this.scale=window.innerWidth/640;this.touch={ScrollObj:undefined,isScroll:false,limitUp:0,limitDown:undefined,overlimit:false,lastX:0,lastY:0,newX:0,newY:0,delta_X:0,delta_Y:0,scrollY:0,touchAllow:true,fingerNumber:0,distance:0,angle:0,delta_angle:0,time:0,offsetTime:0,isTouch:false};this.bgm={obj:document.getElementById("bgm"),id:"bgm",isPlay:false,button:$(".music-btn")};this.V={id:"video",currentTime:0,isPlay:false,obj:document.getElementById("video")};this.tl_galaxy=undefined;this.assetsUrl="http://epshow.img.i-creative.cn/planet/assets/";this.picUrl=this.assetsUrl+"images/";this.textureUrl=this.assetsUrl+"texture/";this.modelsUrl=this.assetsUrl+"models/";this.videoUrl="http://epshow.img.i-creative.cn/planet/video/";this.RAF=undefined;this.ImageList=[{url:this.modelsUrl+"scene/planet.png"},{url:this.modelsUrl+"scene/normal_planet.png"},{url:this.picUrl+"bg2.jpg"},{url:this.picUrl+"box.png"},{url:this.picUrl+"box-btn-1.png"},{url:this.picUrl+"box-btn-2.png"},{url:this.picUrl+"close.png"},{url:this.picUrl+"hl.png"},{url:this.picUrl+"kuang.png"},{url:this.picUrl+"liuxing.png"},{url:this.picUrl+"loading-1.png"},{url:this.picUrl+"loading-arrow.png"},{url:this.picUrl+"loading-bg.jpg"},{url:this.picUrl+"loading-title-1.png"},{url:this.picUrl+"loading-txt-1.png"},{url:this.picUrl+"loading-txt-2.png"},{url:this.picUrl+"logo.png"},{url:this.picUrl+"p1-btn.png"},{url:this.picUrl+"p1-bx-baoxiang.png"},{url:this.picUrl+"p1-bx-txt.png"},{url:this.picUrl+"p1-icon-1.png"},{url:this.picUrl+"p1-icon-1b.png"},{url:this.picUrl+"p1-icon-1txt.png"},{url:this.picUrl+"p1-icon-2.png"},{url:this.picUrl+"p1-icon-2b.png"},{url:this.picUrl+"p1-icon-2txt.png"},{url:this.picUrl+"p1-icon-3.png"},{url:this.picUrl+"p1-icon-3b.png"},{url:this.picUrl+"p1-icon-3txt.png"},{url:this.picUrl+"p1-miaozhun.png"},{url:this.picUrl+"p1-stone1.png"},{url:this.picUrl+"p1-stone2.png"},{url:this.picUrl+"p1-txt-1.png"},{url:this.picUrl+"p1-txt-2.png"},{url:this.picUrl+"p1-zhezhao.png"},{url:this.picUrl+"p2-txt-hlbe.png"},{url:this.picUrl+"p2-txt-wz.png"},{url:this.picUrl+"p2-txt-xby.png"},{url:this.picUrl+"p3-btn-1.png"},{url:this.picUrl+"p3-btn-2.png"},{url:this.picUrl+"p3-btn-3.png"},{url:this.picUrl+"p3-btn-4.png"},{url:this.picUrl+"p3-gift-1.png"},{url:this.picUrl+"p3-gift-2.png"},{url:this.picUrl+"p3-title.png"},{url:this.picUrl+"p4-gift-1.png"},{url:this.picUrl+"p4-gift-2.png"},{url:this.picUrl+"p4-gift-3.png"},{url:this.picUrl+"p4-title.png"},{url:this.picUrl+"p5-ewm.png"},{url:this.picUrl+"p5-infro.png"},{url:this.picUrl+"p5-rule.png"},{url:this.picUrl+"p5-txt.png"},{url:this.picUrl+"p11-btn.png"},{url:this.picUrl+"p11-kuang.png"},{url:this.picUrl+"phone.png"},{url:this.picUrl+"rule.png"},{url:this.picUrl+"rule-arrow.png"},{url:this.picUrl+"rule-title.png"},{url:this.picUrl+"ruleicon.png"},{url:this.picUrl+"share.png"},{url:this.picUrl+"share-bg.png"},{url:this.picUrl+"sp.png"},{url:this.picUrl+"star.png"},{url:this.picUrl+"star2.png"},{url:this.picUrl+"weile.png"},{url:this.picUrl+"wz.png"}];this.clouds=[];for(var e=1;e<=25;e++){var t={};t.url=this.picUrl+"cloud/"+e+".jpg";t.group="clouds";this.ImageList.push(t)}this.ls=[];for(var e=1;e<=38;e++){var t={};t.url=this.modelsUrl+"scene/ls/"+e+".png";t.group="ls";this.ImageList.push(t)}this.loader={haveLoad:0,total:0,complete:false};this.orient=undefined;this.scroll=undefined;this.player1=undefined;this.player2=undefined;this.frames={hlbe:{urls:[],load_complete:false,once:true},spanish:{urls:[],load_complete:false,once:true},wz:{urls:[],load_complete:false,once:true}};if(!vm.ios){for(var e=1;e<=124;e++){var t={};t.url=this.videoUrl+"hlbe/"+e+".jpg";t.group="hlbe";this.ImageList.push(t)}for(var e=1;e<=124;e++){var t={};t.url=this.videoUrl+"spanish/"+e+".jpg";t.group="spanish";this.ImageList.push(t)}for(var e=1;e<=151;e++){var t={};t.url=this.videoUrl+"wz/"+e+".jpg";t.group="wz";this.ImageList.push(t)}}this.stage=1};main.init=function(){$("#translateBg").addClass("ani-bg");three.init();webgl.init();this.loader.total=this.ImageList.length+webgl.loader.total;var e=function(e){if(e.status){vm.server_data.province=e.data}else{console.log(e)}};_getData.getProvince(e);(function(){var e=vm.server_data.game;var t=e.split("|");var i=t.length;if(i>0&&t!=""){for(var a=0;a<i;a++){var n=t[a];vm.server_data.gameData[n].get=true}}})();var e=function(e){if(e.status==1){vm.server_data.name=e.data.vip_name;vm.server_data.tel=e.data.vip_mobile}else{console.log("无法获取到数据")}};_getData.getVipInfo(e);var e=function(e){if(e.status==1&&e.data.lottery_result&&e.data.is_award){vm.server_data.myInfo.province=e.data.shop.province;vm.server_data.myInfo.city=e.data.shop.city;vm.server_data.myInfo.shop=e.data.shop.name}else{console.log(e)}};_getData.getMyInfo(e)};main.start=function(){this.tl_galaxy=new TimelineMax;this.tl_galaxy.to(".galaxy",45,{rotation:20,scale:1.5,ease:"Linear.easeNone"});setTimeout(function(){if(!main.tl_galaxy.paused){main.tl_galaxy.timeScale(10)}},3e3);var e=new ImageLoader;e.load(this.ImageList,function(e){main.loader.haveLoad++;var e=Math.floor(main.loader.haveLoad/main.loader.total*100);$(".num").html(100-e)},function(e){main.clouds=e.clouds;if(!vm.ios){main.frames.hlbe.urls=e.hlbe;main.frames.hlbe.load_complete=true;main.frames.spanish.urls=e.spanish;main.frames.spanish.load_complete=true;main.frames.wz.urls=e.wz;main.frames.wz.load_complete=true}main.ls=e.ls;if(main.loader.haveLoad==main.loader.total){main.loadCallBack()}});webgl.load()};main.TranslateBg=function(){var e={speed:2,obj:$("#sky-bg"),lastGamma:undefined,lastBeta:undefined,offsetGamma:undefined,offsetBeta:undefined,xMax:(11.36-6.4)/2,xMin:-(11.36-6.4)/2,yMax:.5,yMin:-.5,nowX:0,nowY:0};this.orient=new Orienter;this.orient.onOrient=function(t){if(e.lastGamma){e.offsetGamma=t.g-e.lastGamma;if(Math.abs(e.offsetGamma)<20){if(e.nowX+e.offsetGamma/30>e.xMax){e.nowX=e.xMax}else if(e.nowX+e.offsetGamma/30<e.xMin){e.nowX=e.xMin}else{e.nowX+=e.offsetGamma/30}}}if(e.lastBeta){e.offsetBeta=t.b-e.lastBeta;if(Math.abs(e.offsetBeta)<20){if(e.nowY+e.offsetBeta/30>e.yMax){e.nowY=e.yMax}else if(e.nowY+e.offsetBeta/30<e.yMin){e.nowY=e.yMin}else{e.nowY+=e.offsetBeta/30}}}e.obj.css({transform:"translate3d("+e.nowX+"rem,"+e.nowY+"rem,0)"});e.lastGamma=t.g;e.lastBeta=t.b};this.orient.init()};main.loadCallBack=function(){Utils.lazyLoad();this.TranslateBg();this.player1=new Player("player1");this.player1.init(this.clouds);this.player1.callback2=function(){main.startRender();main.stage=1;if(vm.server_data.gameData[webgl.currentPointName].needAnimation){webgl.PointData[webgl.currentPointName].icon.css({opacity:1});$(".animation-box").fi();setTimeout(function(){$(".animation-box").fo();webgl.PointData[webgl.currentPointName].icon.css({transform:"translate3d(0,0,0)",width:"0.5rem"})},2e3)}else{webgl.currentPointName="";vm.server_data.gameData.currentPoint=""}$(".player-container").fo(function(){$("#player1").hide()})};if(!vm.ios){main.player2=new Player("player2");main.player2.speed=80}if(!vm.server_data.haveFill&&vm.server_data.prizeType!=0){var e=vm.palert.choice.fill;var t=vm.palert.txt[e];var i="0.26rem";vm.openAlert(e,t,i);vm.ploading.visible=false;$("#bg .bg1").hide();$("#bg .bg2").show();return}if(vm.server_data.goRegist){vm.ploading.visible=false;var a=function(e){if(e.status){vm.server_data.prizeType=e.lottery_result;vm.pprize.visible=true;vm.ploading.visible=false}else{console.log("抽奖后台出问题了"+e)}};_getData.getPrize(a);$("#bg .bg1").hide();$("#bg .bg2").show();return}main.addEvent();webgl.loadCallback();main.startRender();setTimeout(function(){main.tl_galaxy.pause();vm.ploading.visible=false;vm.pwebgl.visible=true;$(".bg1").fo();$(".bg2").fi();$(".rule").show()},1e3);setTimeout(function(){TweenLite.to(webgl.earthGroup.position,4,{x:0,y:50,z:0,ease:"Linear.easeNone",onComplete:function(){webgl.orbit.enabled=true;var e=undefined;var t=function(){clearTimeout(e);$(this).off("touchstart");$(".P_webgl .tip-box").fo();$(".long-press").fi()};$(".P_webgl").on("touchstart",t);$(".P_webgl .tip-box").fi(function(){$(".P_webgl .tip-box").addClass("ani-tip");e=setTimeout(function(){$(".P_webgl .tip-box").removeClass("ani-tip").fo();$(".long-press").fi();$(".P_webgl").off("touchstart")},2500)});TweenLite.to(webgl.earthGroup.rotation,6,{x:0,y:0,z:0,ease:"Power2.easeOut",onCompele:function(){}})}});TweenLite.to(webgl.earthGroup.scale,4,{x:1,y:1,z:1,ease:"Linear.easeNone",onComplete:function(){}});$(".stone1").addClass("ani-scaleToBig").show();$(".stone2").addClass("ani-scaleToBig").show();setTimeout(function(){$(".stone1").removeClass("ani-scaleToBig").addClass("ani-stone");$(".stone2").removeClass("ani-scaleToBig").addClass("ani-stone2")},6e3)},1500)};main.initLX=function(e){var t=$("<img>").attr("src",this.picUrl+"liuxing.png").addClass("lx");var i=e.container;var a;i.find(".lx").remove();var n=function(){$(this).remove();r();$(this).off("transitionend")};setTimeout(function(){a=t[0].naturalHeight/t[0].naturalWidth;for(var e=0;e<3;e++){r()}},500);function r(){var r=Math.random()*e.delay;var s=Math.random()-.5>0?true:false;var o;var l;var h=THREE.Math.randInt(50,80);var c=h*a;var u=THREE.Math.randFloat(1,2.5)+"s";if(s){o=three.width;l=THREE.Math.randInt(0,three.height)}else{l=c*=-1;o=THREE.Math.randInt(three.width/2,three.width)}var d=t.clone();$(d).on("transitionend",n).css({width:h+"px",left:o+"px",top:l+"px",transition:"transform "+u+" linear"});i.append(d);setTimeout(function(){var e=-(o+h)+"px";var t=(o+h)*a+"px";d.css({transform:"translate3d("+e+","+t+",0)"})},r)}};main.loadFrames=function(e,t){var i=e.urls;var a=i.length;Utils.preloadImage2(i,function(){e.load_complete=true;for(var n=0;n<a;n++){var r=new Image;r.src=i[n];i[n]=r}t()})};main.prule=function(){$(".P_rule").fi();main.scrollInit(".rule-txt",0)};main.pruleleave=function(){$(".P_rule").fo(function(){$(".rule-txt")[0].style.webkitTransform="translate3d(0,0,0)"})};main.scrollInit=function(e){this.touch.ScrollObj=$(e);this.touch.container=$(e).parent();this.touch.StartY=0;this.touch.NewY=0;this.touch.addY=0;this.touch.scrollY=0;this.touch.limitDown=this.touch.ScrollObj.height()<this.touch.container.height()?0:this.touch.container.height()-this.touch.ScrollObj.height()};main.limitNum=function(e){var t=e.value;var i=t.length;if(i>11){t=t.substring(0,11);e.value=t}};main.playbgm=function(){Media.playMedia(this.bgm.id);this.bgm.isPlay=true};main.pausebgm=function(){this.bgm.obj.pause();this.bgm.isPlay=false};main.startRender=function(){var e=function(){three.render();webgl.render();main.RAF=window.requestAnimationFrame(e)};e()};main.stopRender=function(){window.cancelAnimationFrame(main.RAF)};main.addEvent=function(){var e=function(e){$(".tip-box").addClass("ani-tip").show();setTimeout(function(){$(".tip-box").removeClass("ani-tip").fo()},6e3);$(this).off("transitionend");vm.server_data.gameData[webgl.currentPointName].needAnimation=false;webgl.currentPointName="";vm.server_data.gameData.currentPoint="";if(vm.key_index==3){$(".animation-box .tip-all,.animation-box .big-icon").show();$(".animation-box .number").hide();$(".animation-box").fi()}};$(".right-box .icon2").on("transitionend",e);var t=function(){$(this).off("webkitAnimationEnd");$(".P_webgl .text-box").hide()};$(".P_webgl .text-box .txt4").on("webkitAnimationEnd",t);document.body.ontouchmove=function(e){e.preventDefault()};window.onresize=function(){three.onresize()};$(window).on("orientationchange",function(e){if(window.orientation==0||window.orientation==180){vm.hpwarn.visible=false}else if(window.orientation==90||window.orientation==-90){vm.hpwarn.visible=true}});var i=function(){main.player1.direction=-1;main.player1.repeat=0};var a=function(){main.stage=2;webgl.PointData[webgl.currentPointName].img.hide();if(vm.ios){webgl.PointData[webgl.currentPointName].video[0].pause();webgl.PointData[webgl.currentPointName].video[0].currentTime=0;webgl.PointData[webgl.currentPointName].video.hide()}else{$("#player2").hide();main.player2.pause();main.player2.set(0);webgl.PointData[webgl.currentPointName].music.pause();webgl.PointData[webgl.currentPointName].music.currentTime=0}main.player1.direction=-1;main.player1.repeat=0;main.player1.set(main.player1.framesLength-1);main.player1.play();$("#player1").show()};var n=function(){main.player1.direction=1;main.player1.repeat=0};$(".long-press").on({touchstart:function(e){e.preventDefault();main.touch.isTouch=true;switch(main.stage){case 1:break;case 2:n();return;break}webgl.rotateToCenter();if(vm.ios&&webgl.PointData[webgl.currentPointName].video_haveload==false){webgl.PointData[webgl.currentPointName].video[0].load();webgl.PointData[webgl.currentPointName].video_haveload=true}},touchmove:function(){},touchend:function(){main.touch.isTouch=false;switch(main.stage){case 1:break;case 2:i();break;case 3:a();break}}});$(".P_webgl .btn-box").on("touchstart",function(e){e.preventDefault()});var r=undefined;var s=vm.ios?$(".video"):$(".video-bgm");s.on({play:function(e){if(r){clearTimeout(r);r=undefined}main.pausebgm()},pause:function(){if(!r){r=setTimeout(function(){main.playbgm();r=undefined},800)}},end:function(e){if(!r){r=setTimeout(function(){main.playbgm()},800)}}})};main.scrollInit=function(e,t){this.touch.ScrollObj=$(e);this.touch.container=$(e).parent();this.touch.StartY=0;this.touch.NewY=0;this.touch.addY=0;this.touch.scrollY=0;this.touch.limitDown=this.touch.ScrollObj.height()<this.touch.container.height()?0:this.touch.container.height()-this.touch.ScrollObj.height()};$(function(){main.init();main.start();Media.playMedia(main.bgm.id);main.bgm.isPlay=true});